generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
}

model users {
  id          BigInt   @id @db.BigInt
  name        String   @db.VarChar(32)
  avatar      String   @db.VarChar(256)
  email       String   @db.VarChar(256)
  password    String   @db.VarChar(255)
  status      Int
  is_deleted  Boolean
  is_admin    Boolean  @default(false)
  credits     Int      @default(0)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  topics topics[]
  posts  posts[]
  post_likes post_likes[] @relation("post_likes_user")
  post_bookmarks post_bookmarks[] @relation("post_bookmarks_user")
  user_badges user_badges[] @relation("user_badges_user")
  awarded_badges user_badges[] @relation("user_badges_awarder")
  followers user_follows[] @relation("user_follows_following")
  following user_follows[] @relation("user_follows_follower")
  conversations_initiated conversations[] @relation("conversations_user1")
  conversations_received conversations[] @relation("conversations_user2")
  messages messages[] @relation("messages_sender")

  @@map("users")
  @@unique([email], map: "users_email_key")
}

model categories {
  id          BigInt   @id @db.BigInt
  name        String   @db.VarChar(32)
  icon        String   @db.VarChar(32)
  description String?  @db.VarChar(255)
  sort        Int      @default(0)
  bg_color    String?  @db.VarChar(16)
  text_color  String?  @db.VarChar(16)
  is_deleted  Boolean
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  topics topics[]

  @@map("categories")
}

model tags {
  id          BigInt   @id @db.BigInt
  name        String   @db.VarChar(32)
  icon        String   @db.VarChar(32)
  description String   @default("") @db.VarChar(256)
  sort        Int      @default(0)
  bg_color    String?  @db.VarChar(16)
  text_color  String?  @db.VarChar(16)
  is_deleted  Boolean
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  topic_links topic_tags[]

  @@map("tags")
  @@unique([name], map: "name_index")
}

model topics {
  id          BigInt   @id @db.BigInt
  category_id BigInt   @db.BigInt
  user_id     BigInt   @db.BigInt
  title       String   @db.VarChar(256)
  views       Int      @default(0)
  is_pinned   Boolean  @default(false)
  is_community Boolean @default(false)
  is_deleted  Boolean
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  category categories @relation(fields: [category_id], references: [id])
  user     users      @relation(fields: [user_id], references: [id])
  posts    posts[]
  tag_links topic_tags[]

  @@index([user_id], map: "topics_user_index")
  @@index([category_id], map: "topics_category_index")
  @@map("topics")
}

model posts {
  id               BigInt   @id @db.BigInt
  topic_id         BigInt   @db.BigInt
  user_id          BigInt   @db.BigInt
  parent_id        BigInt   @default(0) @db.BigInt
  reply_to_user_id BigInt   @default(0) @db.BigInt
  floor_number     Int
  content          String   @db.Text
  is_deleted       Boolean
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  topic topics @relation(fields: [topic_id], references: [id])
  user  users  @relation(fields: [user_id], references: [id])
  likes post_likes[] @relation("post_likes_post")
  bookmarks post_bookmarks[] @relation("post_bookmarks_post")

  @@index([topic_id], map: "posts_topic_index")
  @@index([user_id], map: "posts_user_index")
  @@map("posts")
}

model topic_tags {
  topic_id   BigInt   @db.BigInt
  tag_id     BigInt   @db.BigInt
  created_at DateTime @default(now())

  topic topics @relation(fields: [topic_id], references: [id])
  tag   tags   @relation(fields: [tag_id], references: [id])

  @@id([topic_id, tag_id])
  @@index([tag_id], map: "topic_tags_tag_index")
  @@index([topic_id], map: "topic_tags_topic_index")
  @@map("topic_tags")
}

model post_likes {
  post_id    BigInt   @db.BigInt
  user_id    BigInt   @db.BigInt
  created_at DateTime @default(now())

  post posts @relation("post_likes_post", fields: [post_id], references: [id])
  user users @relation("post_likes_user", fields: [user_id], references: [id])

  @@id([post_id, user_id])
  @@index([user_id], map: "post_likes_user_index")
  @@index([post_id], map: "post_likes_post_index")
  @@map("post_likes")
}

model post_bookmarks {
  post_id    BigInt   @db.BigInt
  user_id    BigInt   @db.BigInt
  created_at DateTime @default(now())

  post posts @relation("post_bookmarks_post", fields: [post_id], references: [id])
  user users @relation("post_bookmarks_user", fields: [user_id], references: [id])

  @@id([post_id, user_id])
  @@index([user_id], map: "post_bookmarks_user_index")
  @@index([post_id], map: "post_bookmarks_post_index")
  @@map("post_bookmarks")
}

model badges {
  id          BigInt   @id @db.BigInt
  name        String   @db.VarChar(32)
  icon        String   @db.VarChar(32)
  description String?  @db.VarChar(256)
  badge_type  String   @db.VarChar(32)
  level       Int      @default(1)
  sort        Int      @default(0)
  bg_color    String?  @db.VarChar(16)
  text_color  String?  @db.VarChar(16)
  is_enabled  Boolean  @default(true)
  is_visible  Boolean  @default(true)
  is_deleted  Boolean  @default(false)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  user_badges user_badges[] @relation("user_badges_badge")

  @@index([badge_type], map: "badges_type_index")
  @@index([is_deleted, is_enabled], map: "badges_status_index")
  @@map("badges")
}

model user_badges {
  user_id    BigInt   @db.BigInt
  badge_id   BigInt   @db.BigInt
  awarded_at DateTime @default(now())
  awarded_by BigInt?  @db.BigInt
  is_deleted Boolean  @default(false)

  user    users  @relation("user_badges_user", fields: [user_id], references: [id])
  badge   badges @relation("user_badges_badge", fields: [badge_id], references: [id])
  awarder users? @relation("user_badges_awarder", fields: [awarded_by], references: [id])

  @@id([user_id, badge_id])
  @@index([user_id, is_deleted], map: "user_badges_user_index")
  @@index([badge_id, is_deleted], map: "user_badges_badge_index")
  @@index([is_deleted], map: "user_badges_deleted_index")
  @@map("user_badges")
}

model system_configs {
  id            BigInt   @id @db.BigInt
  config_key    String   @unique @db.VarChar(64)
  config_value  String   @db.Text
  config_type   String   @db.VarChar(16)
  category      String   @db.VarChar(32)
  description   String?  @db.VarChar(255)
  is_public     Boolean  @default(false)
  is_sensitive  Boolean  @default(false)
  default_value String   @db.Text
  created_at    DateTime @default(now())
  updated_at    DateTime @updatedAt

  @@index([category], map: "system_configs_category_index")
  @@index([is_public], map: "system_configs_public_index")
  @@map("system_configs")
}

model user_follows {
  follower_id  BigInt   @db.BigInt
  following_id BigInt   @db.BigInt
  created_at   DateTime @default(now())

  follower  users @relation("user_follows_follower", fields: [follower_id], references: [id])
  following users @relation("user_follows_following", fields: [following_id], references: [id])

  @@id([follower_id, following_id])
  @@index([follower_id], map: "user_follows_follower_index")
  @@index([following_id], map: "user_follows_following_index")
  @@map("user_follows")
}

model conversations {
  id         BigInt   @id @db.BigInt
  user1_id   BigInt   @db.BigInt
  user2_id   BigInt   @db.BigInt
  is_deleted Boolean  @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  user1    users      @relation("conversations_user1", fields: [user1_id], references: [id])
  user2    users      @relation("conversations_user2", fields: [user2_id], references: [id])
  messages messages[] @relation("messages_conversation")

  @@index([user1_id], map: "conversations_user1_index")
  @@index([user2_id], map: "conversations_user2_index")
  @@index([user1_id, user2_id], map: "conversations_users_index")
  @@map("conversations")
}

model messages {
  id              BigInt   @id @db.BigInt
  conversation_id BigInt   @db.BigInt
  sender_id       BigInt   @db.BigInt
  content         String   @db.Text
  is_read         Boolean  @default(false)
  is_deleted      Boolean  @default(false)
  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt

  conversation conversations @relation("messages_conversation", fields: [conversation_id], references: [id])
  sender       users         @relation("messages_sender", fields: [sender_id], references: [id])

  @@index([conversation_id], map: "messages_conversation_index")
  @@index([sender_id], map: "messages_sender_index")
  @@index([is_read], map: "messages_read_index")
  @@map("messages")
}
