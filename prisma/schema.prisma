generator client {
  provider   = "prisma-client-js"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
}

model users {
  id          BigInt   @id @db.BigInt
  name        String   @db.VarChar(32)
  avatar      String   @db.VarChar(256)
  email       String   @db.VarChar(256)
  password    String   @db.VarChar(255)
  status      Int
  is_deleted  Boolean
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  topics topics[]
  posts  posts[]
  post_likes post_likes[] @relation("post_likes_user")
  post_bookmarks post_bookmarks[] @relation("post_bookmarks_user")

  @@map("users")
  @@unique([email], map: "users_email_key")
}

model categories {
  id          BigInt   @id @db.BigInt
  name        String   @db.VarChar(32)
  icon        String   @db.VarChar(32)
  description String?  @db.VarChar(255)
  sort        Int      @default(0)
  is_deleted  Boolean
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  topics topics[]

  @@map("categories")
}

model tags {
  id          BigInt   @id @db.BigInt
  name        String   @db.VarChar(32)
  icon        String   @db.VarChar(32)
  description String   @default("") @db.VarChar(256)
  sort        Int      @default(0)
  is_deleted  Boolean
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  topic_links topic_tags[]

  @@map("tags")
  @@unique([name], map: "name_index")
}

model topics {
  id          BigInt   @id @db.BigInt
  category_id BigInt   @db.BigInt
  user_id     BigInt   @db.BigInt
  title       String   @db.VarChar(256)
  views       Int      @default(0)
  is_deleted  Boolean
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt

  category categories @relation(fields: [category_id], references: [id])
  user     users      @relation(fields: [user_id], references: [id])
  posts    posts[]
  tag_links topic_tags[]

  @@index([user_id], map: "topics_user_index")
  @@index([category_id], map: "topics_category_index")
  @@map("topics")
}

model posts {
  id               BigInt   @id @db.BigInt
  topic_id         BigInt   @db.BigInt
  user_id          BigInt   @db.BigInt
  parent_id        BigInt   @default(0) @db.BigInt
  reply_to_user_id BigInt   @default(0) @db.BigInt
  floor_number     Int
  content          String   @db.Text
  is_deleted       Boolean
  created_at       DateTime @default(now())
  updated_at       DateTime @updatedAt

  topic topics @relation(fields: [topic_id], references: [id])
  user  users  @relation(fields: [user_id], references: [id])
  likes post_likes[] @relation("post_likes_post")
  bookmarks post_bookmarks[] @relation("post_bookmarks_post")

  @@index([topic_id], map: "posts_topic_index")
  @@index([user_id], map: "posts_user_index")
  @@map("posts")
}

model topic_tags {
  topic_id   BigInt   @db.BigInt
  tag_id     BigInt   @db.BigInt
  created_at DateTime @default(now())

  topic topics @relation(fields: [topic_id], references: [id])
  tag   tags   @relation(fields: [tag_id], references: [id])

  @@id([topic_id, tag_id])
  @@index([tag_id], map: "topic_tags_tag_index")
  @@index([topic_id], map: "topic_tags_topic_index")
  @@map("topic_tags")
}

model post_likes {
  post_id    BigInt   @db.BigInt
  user_id    BigInt   @db.BigInt
  created_at DateTime @default(now())

  post posts @relation("post_likes_post", fields: [post_id], references: [id])
  user users @relation("post_likes_user", fields: [user_id], references: [id])

  @@id([post_id, user_id])
  @@index([user_id], map: "post_likes_user_index")
  @@index([post_id], map: "post_likes_post_index")
  @@map("post_likes")
}

model post_bookmarks {
  post_id    BigInt   @db.BigInt
  user_id    BigInt   @db.BigInt
  created_at DateTime @default(now())

  post posts @relation("post_bookmarks_post", fields: [post_id], references: [id])
  user users @relation("post_bookmarks_user", fields: [user_id], references: [id])

  @@id([post_id, user_id])
  @@index([user_id], map: "post_bookmarks_user_index")
  @@index([post_id], map: "post_bookmarks_post_index")
  @@map("post_bookmarks")
}
